commit b4d23462900df5bc6cd01320bae6ce119d151d94
Author: Szymichowski, Pawel <pawel.szymichowski@intel.com>
Date:   Tue Sep 22 00:25:32 2020 -0700

    Changes in preparation of LLVM 11 upgrade.
    
    Change-Id: Ieaceae80c5ac321506adb01d98975618c85cf973

diff --git a/IGC/AdaptorOCL/ocl_igc_interface/impl/igc_ocl_translation_ctx_impl.h b/IGC/AdaptorOCL/ocl_igc_interface/impl/igc_ocl_translation_ctx_impl.h
index 85f74c28..086c29e1 100644
--- a/IGC/AdaptorOCL/ocl_igc_interface/impl/igc_ocl_translation_ctx_impl.h
+++ b/IGC/AdaptorOCL/ocl_igc_interface/impl/igc_ocl_translation_ctx_impl.h
@@ -123,7 +123,7 @@ CIF_DECLARE_INTERFACE_PIMPL(IgcOclTranslationCtx) : CIF::PimplBase
 
         if(this->inType == CodeType::spirV){
             llvm::StringRef strInput = llvm::StringRef(pInput, inputSize);
-            std::istringstream IS(strInput);
+            std::istringstream IS(strInput.str());
 
             // vector of pairs [spec_id, spec_size]
             std::vector<std::pair<uint32_t, uint32_t>> SCInfo;
diff --git a/IGC/Compiler/Optimizer/OpenCLPasses/LocalBuffers/InlineLocalsResolution.cpp b/IGC/Compiler/Optimizer/OpenCLPasses/LocalBuffers/InlineLocalsResolution.cpp
index d721e6b6..c0a38e3a 100644
--- a/IGC/Compiler/Optimizer/OpenCLPasses/LocalBuffers/InlineLocalsResolution.cpp
+++ b/IGC/Compiler/Optimizer/OpenCLPasses/LocalBuffers/InlineLocalsResolution.cpp
@@ -416,8 +416,11 @@ void InlineLocalsResolution::computeOffsetList(Module& M, std::map<Function*, un
         {
             // std::map initializes with zero if the value is not present.
             unsigned int offset = sizeMap[F];
+#if LLVM_VERSION_MAJOR < 11
             offset = iSTD::Align(offset, DL.getPreferredAlignment(G));
-
+#else
+            offset = iSTD::Align(offset, DL.getPreferredAlign(G).value());
+#endif
             // Save the offset of the current local
             // (set the high bits to be non-0 here too)
             offsetMap[F][G] = (offset & 0xFFFF);
diff --git a/IGC/Compiler/Optimizer/OpenCLPasses/ProgramScopeConstants/ProgramScopeConstantAnalysis.cpp b/IGC/Compiler/Optimizer/OpenCLPasses/ProgramScopeConstants/ProgramScopeConstantAnalysis.cpp
index 83c58355..dac6840f 100644
--- a/IGC/Compiler/Optimizer/OpenCLPasses/ProgramScopeConstants/ProgramScopeConstantAnalysis.cpp
+++ b/IGC/Compiler/Optimizer/OpenCLPasses/ProgramScopeConstants/ProgramScopeConstantAnalysis.cpp
@@ -169,7 +169,11 @@ bool ProgramScopeConstantAnalysis::runOnModule(Module& M)
         // Align the buffer.
         if (inlineProgramScopeBuffer->size() != 0)
         {
+#if LLVM_VERSION_MAJOR < 11
             alignBuffer(*inlineProgramScopeBuffer, m_DL->getPreferredAlignment(globalVar));
+#else
+            alignBuffer(*inlineProgramScopeBuffer, m_DL->getPreferredAlign(globalVar).value());
+#endif
         }
 
         // Ok, buffer is aligned, remember where this inline variable starts.
@@ -191,7 +195,11 @@ bool ProgramScopeConstantAnalysis::runOnModule(Module& M)
     {
         unsigned AS = cast<PointerType>(globalVar->getType())->getAddressSpace();
         unsigned &offset = (AS == ADDRESS_SPACE_GLOBAL) ? modMd->inlineGlobalBuffers.back().allocSize : modMd->inlineConstantBuffers.back().allocSize;
+#if LLVM_VERSION_MAJOR < 11
         offset = iSTD::Align(offset, m_DL->getPreferredAlignment(globalVar));
+#else
+        offset = iSTD::Align(offset, m_DL->getPreferredAlign(globalVar).value());
+#endif
         inlineProgramScopeOffsets[globalVar] = offset;
         offset += (unsigned)(m_DL->getTypeAllocSize(globalVar->getType()->getPointerElementType()));
     }
